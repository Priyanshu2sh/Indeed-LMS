<!doctype html>
<html lang="en">

<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<head>

    {% load static %}
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.png">

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&amp;family=Lora:wght@400;700&amp;family=Montserrat:wght@400;500;600;700&amp;family=Nunito:wght@400;700&amp;display=swap" rel="stylesheet">

    <!-- Libs CSS -->
    <link rel="stylesheet" href="{% static 'assets/fonts/fontawesome/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/%40fancyapps/fancybox/dist/jquery.fancybox.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/aos/dist/aos.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/choices.js/public/assets/styles/choices.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/flickity-fade/flickity-fade.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/flickity/dist/flickity.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/highlightjs/styles/vs2015.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/jarallax/dist/jarallax.css' %}">
    <link rel="stylesheet" href="{% static 'assets/libs/quill/dist/quill.core.css' %}">

    <!-- Map -->
    <link href='../../../api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />

    <!-- Theme CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/theme.min.css' %}">

    
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

    <title>watch - {{course.title}}</title>

    <style>
.comment-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08), 0 0 12px rgba(0, 180, 216, 0.08);
  transition: all 0.3s ease;
  width: 400px;        
  min-width: 400px;
  max-width: 400px;
  padding: 1.5rem 1.25rem; 
  min-height: auto;

}

{% comment %} .comment-card:hover {
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12), 0 0 14px rgba(15, 14, 9, 0.25);
} {% endcomment %}

.shadow-avatar {
  width: 48px;
  height: 48px;
  object-fit: cover;
  box-shadow: 0 0 0 3px #fcd34d, 0 2px 6px rgba(0, 0, 0, 0.15);
}

.swiper-wrapper {
  display: flex;
  flex-wrap: nowrap;
}


.swiper-slide {
  width: auto !important;
  display: flex;
  justify-content: center;
  align-items: start;
  height: auto;
  margin-right: 40px; 
}

.swiper-wrapper .swiper-slide:last-child {
  margin-right: 0;
}

.commentSwiper {
  padding-bottom: 30px;
}


/* Hide default checkbox */
.custom-checkbox input[type="checkbox"] {
  display: none;
}

/* Custom circular checkbox */
.custom-checkbox label {
  display: inline-block;
  width: 39px;
  height: 25px;
  background-color: #fff;
  border: 2px solid #28a745; 
  border-radius: 50%; 
  position: relative;
  cursor: not-allowed;
  margin-right: 5px;
  margin-bottom: 5px;
}


.custom-checkbox input[type="checkbox"]:checked + label {
  background-color: #28a745;
  border-color: #28a745;
}

.custom-checkbox input[type="checkbox"]:checked + label::after {
  content: 'âœ“';
  color: white;
  ont-size: 16px; 
  font-weight: bold;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.shape-left {
  left: 0;
  max-width: 0;
  overflow: hidden;
}
    </style>


</head>
<body class="bg-white">

    <!-- MODALS
    ================================================== -->
    <!-- Modal Sidebar account -->


    <!-- NAVBAR
    ================================================== -->
    <header class="bg-white border-bottom py-3 header-fixed" >
        <div class="px-5 px-lg-8 w-100">
            <div class="d-md-flex align-items-center">
                <!-- Brand -->
                <a class="navbar-brand mb-2 mb-md-0" href="{% url 'home' %}">
                    <img src="{% static 'assets/img/indeed_logo.png'%}" class="navbar-brand-img" alt="...">
                </a>

                <!-- Lesson Title -->
                <div class="ms-md-6 ms-wd-12 ms-xl-10 me-auto mb-5 mb-md-0">
                    <h3 class="mb-0 line-clamp-2 ms-wd-3">{{course.category.name}}: {{course.title}}</h3>
                </div>

                <!-- Back to Course -->
                <a href="{{course.get_absolute_url}}" class="btn btn-sm btn-primary ms-md-6 px-6 mb-3 mb-md-0 flex-shrink-0">Back to Course</a>
            </div>
        </div>
    </header>


    <!-- COURSE
    ================================================== -->
    <div class="mt-15 mt-md-11 pt-md-3">
        <div class="sidebar-collapse">
            <a class="text-white bg-primary rounded-right-lg p-4 w-60p h-50p" data-bs-toggle="collapse" href="#sidebarcollapseExample" role="button" aria-expanded="false" aria-controls="sidebarcollapseExample">
                <!-- Icon -->
                <svg width="25" height="17" viewBox="0 0 25 17" xmlns="http://www.w3.org/2000/svg">
                    <rect width="25" height="1" fill="currentColor"/>
                    <rect y="8" width="15" height="1" fill="currentColor"/>
                    <rect y="16" width="20" height="1" fill="currentColor"/>
                </svg>

                <svg width="16" height="17" viewBox="0 0 16 17" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.142135 2.00015L1.55635 0.585938L15.6985 14.7281L14.2843 16.1423L0.142135 2.00015Z" fill="currentColor"></path>
                    <path d="M14.1421 1.0001L15.5563 2.41431L1.41421 16.5564L0 15.1422L14.1421 1.0001Z" fill="currentColor"></path>
                </svg>

            </a>

            <div class="collapse shadow" id="sidebarcollapseExample">
                {% comment %}
                <div class="p-5">
                    <!-- Search -->
                    <form class="mt-10 mt-sm-0">
                        <div class="input-group border rounded">
                            <div class="input-group-prepend">
                                <button class="btn btn-sm text-secondary" type="submit">
                                    <!-- Icon -->
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8.80758 0C3.95121 0 0 3.95121 0 8.80758C0 13.6642 3.95121 17.6152 8.80758 17.6152C13.6642 17.6152 17.6152 13.6642 17.6152 8.80758C17.6152 3.95121 13.6642 0 8.80758 0ZM8.80758 15.9892C4.8477 15.9892 1.62602 12.7675 1.62602 8.80762C1.62602 4.84773 4.8477 1.62602 8.80758 1.62602C12.7675 1.62602 15.9891 4.8477 15.9891 8.80758C15.9891 12.7675 12.7675 15.9892 8.80758 15.9892Z" fill="currentColor"/>
                                        <path d="M19.762 18.6121L15.1007 13.9509C14.7831 13.6332 14.2687 13.6332 13.9511 13.9509C13.6335 14.2682 13.6335 14.7831 13.9511 15.1005L18.6124 19.7617C18.7712 19.9205 18.9791 19.9999 19.1872 19.9999C19.395 19.9999 19.6032 19.9205 19.762 19.7617C20.0796 19.4444 20.0796 18.9295 19.762 18.6121Z" fill="currentColor"/>
                                    </svg>

                                </button>
                            </div>
                            <input class="form-control form-control-sm border-0 ps-0" type="search" placeholder="Search item" aria-label="Search">
                        </div>
                    </form>
                </div>
                {% endcomment %}

                <div id="accordionCurriculum" class="sidebar-collapse-scroll">
                    {% for lesson in course.lesson_set.all %}
                    <div class="overflow-hidden">
                        <div class="d-flex align-items-center" id="curriculumheadingOne">
                            <h5 class="mb-0 w-100">
                                <button class="d-flex align-items-center p-5 min-height-80 text-dark fw-medium collapse-accordion-toggle line-height-one" type="button" data-bs-toggle="collapse" data-bs-target="#id{{lesson.id}}" aria-expanded="true" aria-controls="CurriculumcollapseOne">
                                    <span class="me-4 text-dark d-flex">
                                        <!-- Icon -->
                                        <svg width="15" height="2" viewBox="0 0 15 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <rect width="15" height="2" fill="currentColor"/>
                                        </svg>

                                        <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M0 7H15V9H0V7Z" fill="currentColor"/>
                                            <path d="M6 16L6 8.74228e-08L8 0L8 16H6Z" fill="currentColor"/>
                                        </svg>

                                    </span>

                                    {{lesson.name}}
                                </button>
                            </h5>
                        </div>
                        {% for video in lesson.video_set.all %}
                        <div id="id{{video.lesson.id}}" class="collapse show" aria-labelledby="curriculumheadingOne" data-parent="#accordionCurriculum">
                            <div class="border-top px-5 py-4 min-height-70 d-md-flex align-items-center">
                                <div class="d-flex align-items-center me-auto mb-4 mb-md-0">
                                    <div class="text-secondary d-flex">
                                        <i class="fa fa-youtube-play" aria-hidden="true" style="color: red;"></i>

                                    </div>

                           <div class="d-flex align-items-center ms-4 mb-2 custom-checkbox">
                                <input type="checkbox"
                                    id="video_{{ video.serial_number }}"
                                    name="video_checkbox"
                                    value="{{ video.serial_number }}"
                                    title="{% if video.serial_number in completed_videos %}Completed{% else %}Not completed{% endif %}"
                                    {% if video.serial_number in completed_videos %}checked{% endif %}
                                    onclick="return false;" />

                                <!-- Custom styled label that shows checkbox look -->
                                <label for="video_{{ video.serial_number }}"></label>

                                <!-- Video title -->
                                <a href="?lecture={{ video.serial_number }}" class="text-decoration-none text-dark ms-1">
                                    {{ video.title }}
                                </a>
                                </div>


                                </div>

                                <div class="d-flex align-items-center overflow-auto overflow-md-visible flex-shrink-all">
                                    <div class="badge btn-blue-soft me-5 font-size-sm fw-normal py-2">{{video.time_duration}} min</div>
                                    <a href="?lecture={{video.serial_number}}" class="text-secondary d-flex">
                                        <!-- Icon -->
                                        <svg width="14" height="16" viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12.8704 6.15374L3.42038 0.328572C2.73669 -0.0923355 1.9101 -0.109836 1.20919 0.281759C0.508282 0.673291 0.0898438 1.38645 0.0898438 2.18929V13.7866C0.0898438 15.0005 1.06797 15.9934 2.27016 16C2.27344 16 2.27672 16 2.27994 16C2.65563 16 3.04713 15.8822 3.41279 15.6591C3.70694 15.4796 3.79991 15.0957 3.62044 14.8016C3.44098 14.5074 3.05697 14.4144 2.76291 14.5939C2.59188 14.6982 2.42485 14.7522 2.27688 14.7522C1.82328 14.7497 1.33763 14.3611 1.33763 13.7866V2.18933C1.33763 1.84492 1.51713 1.53907 1.81775 1.3711C2.11841 1.20314 2.47294 1.21064 2.76585 1.39098L12.2159 7.21615C12.4999 7.39102 12.6625 7.68262 12.6618 8.01618C12.6611 8.34971 12.4974 8.64065 12.2118 8.81493L5.37935 12.9983C5.08548 13.1783 4.9931 13.5623 5.17304 13.8562C5.35295 14.1501 5.73704 14.2424 6.03092 14.0625L12.8625 9.87962C13.5166 9.48059 13.9081 8.78496 13.9096 8.01868C13.9112 7.25249 13.5226 6.55524 12.8704 6.15374Z" fill="currentColor"/>
                                        </svg>

                                    </a>
                                </div>
                            </div>

                            
                        </div>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row mb-11">
                <div class="col-lg-11 col-wd-12 ms-lg-auto pt-11 pt-lg-8">
                    {% if messages %}
                        {% for message in messages %}
                            {% if message.tags == 'error' %}
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    {{message}}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                </div>
                            {% elif message.tags == 'success' %}
                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                    {{message}}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                </div>
                            {% elif message.tags == 'warning' %}
                                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                    {{message}}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    <h2 class="font-size-xl mb-6">
                        {{video.title}}
                    </h2>

                    {% load youtube_extras %}
                    <div id="video-container">
                        <div id="video-thumbnail" style="position: relative; cursor: pointer;">
                            <img src="/lms/{{ video.thumbnail }}" alt="..." style="width: 100%; height: 100%;">
                            <div style="
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                background: rgba(0,0,0,0.5);
                                border-radius: 50%;
                                width: 60px;
                                height: 60px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <svg width="30" height="30" viewBox="0 0 14 16" fill="white">
                                    <path d="M12.8704 6.15374L3.42038 0.328572C2.73669 -0.0923355 1.9101 -0.109836 1.20919 0.281759C0.508282 0.673291 0.0898438 1.38645 0.0898438 2.18929V13.7866C0.0898438 15.0005 1.06797 15.9934 2.27016 16C2.27344 16 2.27672 16 2.27994 16C2.65563 16 3.04713 15.8822 3.41279 15.6591C3.70694 15.4796 3.79991 15.0957 3.62044 14.8016C3.44098 14.5074 3.05697 14.4144 2.76291 14.5939C2.59188 14.6982 2.42485 14.7522 2.27688 14.7522C1.82328 14.7497 1.33763 14.3611 1.33763 13.7866V2.18933C1.33763 1.84492 1.51713 1.53907 1.81775 1.3711C2.11841 1.20314 2.47294 1.21064 2.76585 1.39098L12.2159 7.21615C12.4999 7.39102 12.6625 7.68262 12.6618 8.01618C12.6611 8.34971 12.4974 8.64065 12.2118 8.81493L5.37935 12.9983C5.08548 13.1783 4.9931 13.5623 5.17304 13.8562C5.35295 14.1501 5.73704 14.2424 6.03092 14.0625L12.8625 9.87962C13.5166 9.48059 13.9081 8.78496 13.9096 8.01868C13.9112 7.25249 13.5226 6.55524 12.8704 6.15374Z"/>
                                </svg>
                            </div>
                        </div>

                        <div id="player" style="display: none; width: 100%; max-width: 1000px; margin: auto;"></div>

                    </div>
 
                        <!-- Empty div for the YouTube player -->
                        <div id="player" style="display:none;"></div>

                    <h3 class="">Description</h3>

                    <p id="video-description" class="text-muted mb-0" style="max-height: 100px; overflow: hidden; transition: max-height 0.3s ease;">
                    {{ video.description }}
                    </p>
                    <br>

                   <div class="d-md-flex align-items-center justify-content-between mb-8">
    {% if is_first_video == False %}
    <a href="?previous={{ video.serial_number }}" 
       class="btn btn-teal d-flex align-items-center text-white mb-5 mb-md-0 btn-block mw-md-280p justify-content-center gap-2">
        <i class="fas fa-arrow-left font-size-xs"></i>
        <span>Previous</span>
    </a>
    {% endif %}
    
    {% if is_last_video == False %}
    <a href="?next={{ video.serial_number }}" 
       class="btn btn-teal d-flex align-items-center text-white btn-block mw-md-280p justify-content-center mt-0 gap-2">
        <span>Next</span>
        <i class="fas fa-arrow-right font-size-xs"></i>
    </a>
    {% endif %}
</div>


                    <!-- Comment Swiper -->
                    <h3 class="mb-6">Comments</h3>
                    <div class="swiper commentSwiper">
                    <div class="swiper-wrapper">
                        {% for comment in comments %}
                        <div class="swiper-slide">
                        <div class="comment-card p-4">
                            <div class="d-flex align-items-center mb-3">
                            <img src="{% static 'assets/img/avatars/avatar-1.jpg' %}" class="avatar avatar-md rounded-circle me-3 shadow-avatar" alt="Avatar" />
                            <div>
                                <h5 class="mb-0 text-dark">{{ comment.user.first_name }} {{ comment.user.last_name }}</h5>
                                <small class="text-muted font-italic">{{ comment.title }}</small>
                            </div>
                            </div>
                            <p class="mb-0 text-gray-700">{{ comment.content }}</p>
                        </div>
                        </div>
                        {% endfor %}
                    </div>
                    </div>

                      <div class="border shadow rounded p-6 p-md-9 text-center">
                        <h3 class="mb-2">Add Reviews & Rate</h3>
                        <div class="">What is it like to Course?</div>
                          <div class="d-flex justify-content-center">
                        <form method="post">
                            {% csrf_token %}
                            <div class="clearfix">
                                <fieldset class="slect-rating mb-3">
                                    <input type="radio" id="star5" name="rating" value="5" />
                                    <label class = "full" for="star5" title="Awesome - 5 stars"></label>

                                    <input type="radio" id="star4half" name="rating" value="4.5" />
                                    <label class="half" for="star4half" title="Pretty good - 4.5 stars"></label>

                                    <input type="radio" id="star4" name="rating" value="4" />
                                    <label class = "full" for="star4" title="Pretty good - 4 stars"></label>

                                    <input type="radio" id="star3half" name="rating" value="3.5" />
                                    <label class="half" for="star3half" title="Meh - 3.5 stars"></label>

                                    <input type="radio" id="star3" name="rating" value="3" />
                                    <label class = "full" for="star3" title="Meh - 3 stars"></label>

                                    <input type="radio" id="star2half" name="rating" value="2.5" />
                                    <label class="half" for="star2half" title="Kinda bad - 2.5 stars"></label>

                                    <input type="radio" id="star2" name="rating" value="2" />
                                    <label class = "full" for="star2" title="Kinda bad - 2 stars"></label>

                                    <input type="radio" id="star1half" name="rating" value="1.5" />
                                    <label class="half" for="star1half" title="Meh - 1.5 stars"></label>

                                    <input type="radio" id="star1" name="rating" value="1" />
                                    <label class = "full" for="star1" title="Sucks big time - 1 star"></label>

                                    <input type="radio" id="starhalf" name="rating" value="0.5" />
                                    <label class="half" for="starhalf" title="Sucks big time - 0.5 stars"></label>
                                </fieldset>
                            </div>
                            </div>

                            <div class="form-group mb-6">
                                <label for="exampleInputTitle1">Review Title</label>
                                <input type="text" class="form-control placeholder-1" name="title" id="exampleInputTitle1" placeholder="Courses" required>
                            </div>

                            <div class="form-group mb-6">
                                <label for="exampleFormControlTextarea1">Review Content</label>
                                <textarea class="form-control placeholder-1" name="content" id="exampleFormControlTextarea1" rows="6" placeholder="Content" required></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary btn-block mw-md-300p">SUBMIT REVIEW</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT
    ================================================== -->
    <!-- Libs JS -->
    <script src="{% static 'assets/libs/jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/libs/%40fancyapps/fancybox/dist/jquery.fancybox.min.js' %}"></script>
    <script src="{% static 'assets/libs/aos/dist/aos.js' %}"></script>
    <script src="{% static 'assets/libs/choices.js/public/assets/scripts/choices.min.js' %}"></script>
    <script src="{% static 'assets/libs/countup.js/dist/countUp.min.js' %}"></script>
    <script src="{% static 'assets/libs/dropzone/dist/min/dropzone.min.js' %}"></script>
    <script src="{% static 'assets/libs/flickity/dist/flickity.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/libs/flickity-fade/flickity-fade.js' %}"></script>
    <script src="{% static 'assets/libs/highlightjs/highlight.pack.min.js' %}"></script>
    <script src="{% static 'assets/libs/imagesloaded/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/libs/isotope-layout/dist/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/libs/jarallax/dist/jarallax.min.js' %}"></script>
    <script src="{% static 'assets/libs/jarallax/dist/jarallax-video.min.js' %}"></script>
    <script src="{% static 'assets/libs/jarallax/dist/jarallax-element.min.js' %}"></script>
    <script src="{% static 'assets/libs/parallax-js/dist/parallax.min.js' %}"></script>
    <script src="{% static 'assets/libs/quill/dist/quill.min.js' %}"></script>
    <script src="{% static 'assets/libs/smooth-scroll/dist/smooth-scroll.min.js' %}"></script>
    <script src="{% static 'assets/libs/typed.js/lib/typed.min.js' %}"></script>

    <!-- Map -->
    <script src='../../../api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

    <!-- Theme JS -->
    <script src="{% static 'assets/js/theme.min.js' %}"></script>


</body>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    new Swiper(".commentSwiper", {
      slidesPerView: 1,
      spaceBetween: 30,
      loop: true,
      autoplay: {
        delay: 3000,
        disableOnInteraction: false,
      },
      breakpoints: {
        768: {
          slidesPerView: 2,
        },
        992: {
          slidesPerView: 3,
        },
      },
    });
  });
</script>


<script>
    var player;
    var videoId = "{{ video.youtube_link|youtube_video_id }}";
    var progressInterval = null;

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById("video-thumbnail").addEventListener("click", loadVideo);
    });

    function loadVideo() {
        document.getElementById("video-thumbnail").style.display = "none";
        document.getElementById("player").style.display = "block";

        player = new YT.Player('player', {
            height: '500',     
            width: '1000', 
            videoId: videoId,
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        event.target.playVideo();
    }

    let watchedSeconds = 0;
    let lastTime = 0;

    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
            lastTime = player.getCurrentTime();

            if (!progressInterval) {
                progressInterval = setInterval(() => {
                    let currentTime = player.getCurrentTime();

                    if (currentTime > lastTime) {
                        watchedSeconds += (currentTime - lastTime);
                    }

                    lastTime = currentTime;

                    // Optionally save progress every few seconds
                    saveProgress(watchedSeconds, false);

                }, 5000);
            }
        } else if (
            event.data === YT.PlayerState.PAUSED ||
            event.data === YT.PlayerState.ENDED
        ) {
            clearInterval(progressInterval);
            progressInterval = null;
        }

        if (event.data === YT.PlayerState.ENDED) {
            clearInterval(progressInterval);
            progressInterval = null;

            // At END, call saveProgress with final watched time
            saveProgress(watchedSeconds, true);
        }
    }

    var is_last_video = Boolean({{is_last_video}});
    function saveProgress(seconds, completed) {
        let videoDuration = player.getDuration();

        fetch("{% url 'save_video_progress' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({
                video_id: "{{ video.id }}",
                seconds_watched: seconds,
                completed: completed,
                video_duration: videoDuration
            })
        })
        .then(res => res.json())
        .then(data => {
            console.log("Progress response:", data);
            if (data.status === "completed" && completed == true) {
                if (!is_last_video) {
                    setTimeout(redirect, 3000);
                    function redirect(){
                        window.location.href = '?next={{ video.serial_number }}';
                    }
                }
            } else if (data.status === "incomplete") {
                alert(data.message);
            }
        })
        .catch(err => console.error("Progress save error:", err));
    }

</script>

<script>
$(document).ready(function () {
    $('form').submit(function (e) {
        e.preventDefault();
        
        var form = $(this);
        var url = window.location.href;
        
        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(),
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function (response) {
                if (response.status === 'success') {
                    alert(response.message);
                    form.trigger("reset");
                } else if (response.status === 'error') {
                    alert(response.message);
                }
            },
            error: function () {
                alert("Something went wrong. Please try again.");
            }
        });
    });
});
</script>

</html>

</html>
